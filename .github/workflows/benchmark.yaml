name: benchmarks
on:
  push:
    branches: [main]
    tags: ['v*']
  pull_request:
    branches: [main]
  schedule:
    - cron: '15 22 * * *'
  workflow_dispatch: {} # support manual runs
permissions:
  contents: read
jobs:
  benchmarks:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: setup-go
        uses: actions/setup-go@v3
        with:
          go-version: '1.19.x'
      - name: benchmarks
        run: |
          make build
          cd internal/benchmarks
          go test -bench '^BenchmarkGoogleapisProto(?:compile|parse)(?:Canonical|NoSourceInfo)?$' -run 'match-nothing' -timeout 20m -count 10